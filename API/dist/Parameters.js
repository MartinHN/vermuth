var __decorate = (this && this.__decorate) || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") { r = Reflect.decorate(decorators, target, key, desc); } else { for (var i = decorators.length - 1; i >= 0; i--) { if (d = decorators[i]) { r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r; } } }
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
const EventEmitter = require("events");
function uuidv4() {
    return "xxxx".replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0, v = c == "x" ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}
class GenericNodePoint {
    constructor(_name) {
        this._name = _name;
        this.uid = uuidv4();
        this.events = new EventEmitter();
    }
    get name() {
        return this._name;
    }
    set name(n) {
        this._name = n;
        this.events.emit("nameChanged", this);
    }
    computePath() {
        const path = [this.name];
        let i = this.parentContainer;
        while (i) {
            path.push(i.name);
            i = i.parentContainer;
        }
        path.reverse();
        return path;
    }
    computeAddress() {
        return "/" + this.computePath().join("/");
    }
    stringId() { return "" + this.name + "(" + this.uid + ")"; }
    setParentInternal() { }
    setParentContainer(p) {
        console.log("setting Node Parent", p.stringId(), "to", this.stringId());
        this.parentContainer = p;
        this.setParentInternal();
    }
}
class GenericParameter extends GenericNodePoint {
    constructor(name) {
        super(name);
    }
    get() {
        return this._value;
    }
    set(v, notifier = undefined) {
        console.log("setting p value", this.stringId());
        this._value = v;
        if (this.parentContainer) {
            this.parentContainer.notifyChildChanged(this);
        }
        this.events.emit("valueChanged", this, notifier);
    }
    setParentInternal() {
        console.log("set parameter parent", this.parentContainer.stringId(), "to", this.stringId());
    }
}
class ParameterContainer extends GenericNodePoint {
    constructor(name) {
        super(name);
        this.parameterContainers = {};
        this.parameters = {};
        this.feedbackListeners = new Array();
        this.hierarchyListeners = new Array();
    }
    addParameter(p) {
        this.parameters[p.name] = p;
        p.setParentContainer(this);
        return p;
    }
    removeParameter(p) {
        p.setParentContainer(undefined);
        delete this.parameters[p.name];
        this.events.emit("parameterRemoved", this);
        return p;
    }
    addParameterContainer(p) {
        this.parameterContainers[p.name] = p;
        p.setParentContainer(this);
        this.events.emit("parameterContainerAdded", this);
        return p;
    }
    removeParameterContainer(p) {
        p.setParentContainer(undefined);
        this.parameterContainers[p.name] = p;
        this.events.emit("parameterContainerRemoved", this);
        return p;
    }
    notifyChildChanged(p) {
        let notified = this;
        while (notified) {
            for (const f of notified.feedbackListeners) {
                f.parameterChanged(this, p);
            }
            notified = notified.parentContainer;
        }
    }
}
class Parameter extends GenericParameter {
}
// type ParameterContainerHierarchyListener = ParameterContainerHierarchyListenerI<ParameterContainer,Parameter>
//
// {
//    parameterAdded( pc: ParameterContainer, p: Parameter) {};
//    parameterRemoved( pc: ParameterContainer, p: Parameter) {};
//    parameterContainerAdded( pc: ParameterContainer, p: Parameter) {};
//    parameterContainerRemoved( pc: ParameterContainer, p: Parameter) {};
// }
///////////////////////
// DECORATORS
///////////////////////
function BindParameter(...args) {
    return function(target, key) {
        if (!target.staticParams) {
            target.staticParams = {};
        }
        target.staticParams[key] = args;
    };
}
function BindParameterContainer(...args) {
    return function(target, key) {
        if (!target.staticParamConts) {
            target.staticParamConts = {};
        }
        target.staticParamConts[key] = args;
    };
}
function BindContainer() {
    return function(constructor) {
        console.log("eval const");
        return class extends constructor {
            constructor(...args) {
                super(...args);
                console.log("try to bound static");
                const checkName = (pn) => {
                    if (!("" + this[pn].name in [pn, ""])) {
                        this[pn].name = pn;
                        console.error("renaming Node to its key name");
                    }
                };
                if (this.staticParams) {
                    for (const pn of Object.keys(this.staticParams)) {
                        if (!this[pn]) {
                            console.log("creating param ", pn);
                            this[pn] = new Parameter(pn);
                        } else {
                            checkName(pn);
                        }
                        this.addParameter(this[pn]);
                    }
                }
                if (this.staticParamConts) {
                    for (const pn of Object.keys(this.staticParamConts)) {
                        if (!this[pn]) {
                            console.log("creating param ", pn);
                            this[pn] = new ParameterContainer(pn);
                        } else {
                            checkName(pn);
                        }
                        this.addParameterContainer(this[pn]);
                    }
                }
            }
        };
    };
}
//////////////////////////
// TEST
/////////////////////////
let RootCont = class RootCont extends ParameterContainer {
    constructor() {
        super("pCont");
        this.subCont = new ParameterContainer("lkj");
    }
};
__decorate([
    BindParameter(),
], RootCont.prototype, "num", void 0);
__decorate([
    BindParameterContainer(),
], RootCont.prototype, "subCont", void 0);
RootCont = __decorate([
    BindContainer(),
], RootCont);
console.log("instanciate");
const cont = new RootCont();
function S(o) {
    const res = [];
    for (const a in o) {
        res.push([a, o[a]]);
    }
    return res;
    // return Object.keys(o);
    // return JSON.stringify(o);
}
console.log(S(cont));
console.log("setting");
cont.num.set(6);
console.log(cont.num.computeAddress());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGFyYW1ldGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL1BhcmFtZXRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBRXZDLFNBQVMsTUFBTTtJQUNiLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsVUFBUyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUNuRSxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDeEIsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBVUQsTUFBTSxnQkFBZ0I7SUFJcEIsWUFBcUIsS0FBWTtRQUFaLFVBQUssR0FBTCxLQUFLLENBQU87UUFIMUIsUUFBRyxHQUFHLE1BQU0sRUFBRSxDQUFDO1FBQ1osV0FBTSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7SUFHdEMsQ0FBQztJQUVELElBQUksSUFBSTtRQUNOLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUNwQixDQUFDO0lBRUQsSUFBSSxJQUFJLENBQUMsQ0FBUTtRQUNmLElBQUksQ0FBQyxLQUFLLEdBQUMsQ0FBQyxDQUFBO1FBQ1osSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFJTSxXQUFXO1FBRWhCLE1BQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQ3hCLElBQUksQ0FBQyxHQUFjLElBQUksQ0FBQyxlQUFlLENBQUM7UUFDeEMsT0FB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QUE7UUFPVCxZQUFPLEdBQUcsSUFBSSxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQU4vQyxDQUFDO0NBUUYsQ0FBQTtBQUxDO0lBREMsYUFBYSxFQUFFO3FDQUNKO0FBR1o7SUFEQyxzQkFBc0IsRUFBRTt5Q0FDc0I7QUFUM0MsUUFBUTtJQURiLGFBQWEsRUFBRTtHQUNWLFFBQVEsQ0FXYjtBQUlELE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUE7QUFDMUIsTUFBTSxJQUFJLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQTtBQUkzQixTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQ1YsTUFBTSxHQUFHLEdBQUksRUFBRSxDQUFBO0lBQ2YsS0FBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUM7UUFDZixHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7S0FDbkI7SUFDRCxPQUFPLEdBQUcsQ0FBQTtJQUNWLHlCQUF5QjtJQUN6Qiw0QkFBNEI7QUFDOUIsQ0FBQztBQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7QUFHckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQTtBQUN0QixJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBRSxDQUFDLENBQUMsQ0FBQTtBQUloQixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEV2ZW50RW1pdHRlciA9IHJlcXVpcmUoJ2V2ZW50cycpO1xuXG5mdW5jdGlvbiB1dWlkdjQoKSB7XG4gIHJldHVybiAneHh4eCcucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbihjKSB7XG4gICAgdmFyIHIgPSBNYXRoLnJhbmRvbSgpICogMTYgfCAwLCB2ID0gYyA9PSAneCcgPyByIDogKHIgJiAweDMgfCAweDgpO1xuICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgfSk7XG59XG5cblxuaW50ZXJmYWNlIE5vZGVDbGFzc0l7XG4gICBuYW1lOnN0cmluZztcbiAgIHBhcmVudENvbnRhaW5lcjpOb2RlQ2xhc3NJXG4gICBzdHJpbmdJZCgpOiBzdHJpbmdcbn1cblxuXG5jbGFzcyBHZW5lcmljTm9kZVBvaW50PENvbnRhaW5lckNsYXNzIGV4dGVuZHMgTm9kZUNsYXNzST4ge1xuICBwdWJsaWMgdWlkID0gdXVpZHY0KCk7XG4gIHByb3RlY3RlZCBldmVudHMgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgY29uc3RydWN0b3IgKHByaXZhdGUgX25hbWU6c3RyaW5nKXtcbiAgfVxuXG4gIGdldCBuYW1lKCl7XG4gICAgcmV0dXJuIHRoaXMuX25hbWU7XG4gIH1cblxuICBzZXQgbmFtZShuOnN0cmluZyl7XG4gICAgdGhpcy5fbmFtZT1uXG4gICAgdGhpcy5ldmVudHMuZW1pdCgnbmFtZUNoYW5nZWQnLHRoaXMpO1xuICB9XG5cbiAgcHVibGljIHBhcmVudENvbnRhaW5lcjogQ29udGFpbmVyQ2xhc3MgfCB1bmRlZmluZWQ7XG5cbiAgcHVibGljIGNvbXB1dGVQYXRoKCl7XG4gICAgXG4gICAgY29uc3QgcGF0aCA9IFt0aGlzLm5hbWVdXG4gICAgbGV0IGkgOk5vZGVDbGFzc0k9IHRoaXMucGFyZW50Q29udGFpbmVyO1xuICAgIHdoaWxlKGkpe1xuICAgICAgcGF0aC5wdXNoKGkubmFtZSlcbiAgICAgIGkgPSBpLnBhcmVudENvbnRhaW5lclxuICAgIH1cbiAgICBwYXRoLnJldmVyc2UoKVxuICAgIHJldHVybiBwYXRoXG4gIH1cblxuICBwdWJsaWMgY29tcHV0ZUFkZHJlc3MoKXtcbiAgICByZXR1cm4gXCIvXCIrdGhpcy5jb21wdXRlUGF0aCgpLmpvaW4oXCIvXCIpO1xuICB9XG5cblxuICBwdWJsaWMgc3RyaW5nSWQoKSB7IHJldHVybiBcIlwiK3RoaXMubmFtZSArXCIoXCIrdGhpcy51aWQrXCIpXCIgfVxuXG4gIHByb3RlY3RlZCBzZXRQYXJlbnRJbnRlcm5hbCgpe31cblxuICBwdWJsaWMgc2V0UGFyZW50Q29udGFpbmVyKHAgOiBDb250YWluZXJDbGFzcyAgfCB1bmRlZmluZWQpe1xuICAgIGNvbnNvbGUubG9nKCdzZXR0aW5nIE5vZGUgUGFyZW50JyxwLnN0cmluZ0lkKCksJ3RvJyx0aGlzLnN0cmluZ0lkKCkpXG4gICAgdGhpcy5wYXJlbnRDb250YWluZXIgPSBwO1xuICAgIHRoaXMuc2V0UGFyZW50SW50ZXJuYWwoKVxuICB9XG5cbn1cblxuXG5cbmNsYXNzIEdlbmVyaWNQYXJhbWV0ZXI8Q29udGFpbmVyQ2xhc3MgPiBleHRlbmRzIEdlbmVyaWNOb2RlUG9pbnQ8UGFyYW1ldGVyQ29udGFpbmVyPntcbiAgY29uc3RydWN0b3IgKG5hbWU6c3RyaW5nKXtcbiAgICBzdXBlcihuYW1lKTtcbiAgfVxuICBwcml2YXRlIF92YWx1ZTtcblxuICBwdWJsaWMgZ2V0KCl7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlXG4gIH1cblxuICBwdWJsaWMgc2V0KHYsbm90aWZpZXI9dW5kZWZpbmVkKXtcbiAgICBjb25zb2xlLmxvZyhcInNldHRpbmcgcCB2YWx1ZVwiLHRoaXMuc3RyaW5nSWQoKSk7XG4gICAgdGhpcy5fdmFsdWUgPSB2XG4gICAgaWYodGhpcy5wYXJlbnRDb250YWluZXIpe1xuICAgICAgdGhpcy5wYXJlbnRDb250YWluZXIubm90aWZ5Q2hpbGRDaGFuZ2VkKHRoaXMpXG4gICAgfVxuICAgIHRoaXMuZXZlbnRzLmVtaXQoJ3ZhbHVlQ2hhbmdlZCcsdGhpcyxub3RpZmllcik7XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0UGFyZW50SW50ZXJuYWwoKXtcbiAgICBjb25zb2xlLmxvZygnc2V0IHBhcmFtZXRlciBwYXJlbnQnLHRoaXMucGFyZW50Q29udGFpbmVyLnN0cmluZ0lkKCksJ3RvJyx0aGlzLnN0cmluZ0lkKCkpXG4gIH1cblxufVxudHlwZSBQYXJhbWV0ZXJUeXBlID0gR2VuZXJpY1BhcmFtZXRlcjxQYXJhbWV0ZXJDb250YWluZXI+O1xuXG5cblxuaW50ZXJmYWNlIFBhcmFtZXRlckNvbnRhaW5lckhpZXJhcmNoeUxpc3RlbmVySTxQYXJhbWV0ZXJDb250YWluZXIgZXh0ZW5kcyBHZW5lcmljTm9kZVBvaW50PFBhcmFtZXRlckNvbnRhaW5lcj4sIFBhcmFtZXRlclR5cGUgPntcbiAgIHBhcmFtZXRlckFkZGVkKCBwYzogUGFyYW1ldGVyQ29udGFpbmVyLCBwOiBQYXJhbWV0ZXIpIDogdm9pZDtcbiAgIHBhcmFtZXRlclJlbW92ZWQoIHBjOiBQYXJhbWV0ZXJDb250YWluZXIsIHA6IFBhcmFtZXRlcikgOiB2b2lkO1xuICAgcGFyYW1ldGVyQ29udGFpbmVyQWRkZWQoIHBjOiBQYXJhbWV0ZXJDb250YWluZXIsIHA6IFBhcmFtZXRlcikgOiB2b2lkO1xuICAgcGFyYW1ldGVyQ29udGFpbmVyUmVtb3ZlZCggcGM6IFBhcmFtZXRlckNvbnRhaW5lciwgcDogUGFyYW1ldGVyKSA6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBQYXJhbWV0ZXJGZWVkYmFja0xpc3RlbmVySTxQYXJhbWV0ZXJDb250YWluZXIgZXh0ZW5kcyBHZW5lcmljTm9kZVBvaW50PFBhcmFtZXRlckNvbnRhaW5lcj4sIFBhcmFtZXRlciBleHRlbmRzIEdlbmVyaWNQYXJhbWV0ZXI8UGFyYW1ldGVyQ29udGFpbmVyPiA+e1xuICAgcGFyYW1ldGVyQ2hhbmdlZCggcGM6IFBhcmFtZXRlckNvbnRhaW5lciwgcDogUGFyYW1ldGVyKTp2b2lkO1xufVxuXG5cbnR5cGUgUGFyYW1ldGVyRmVlZGJhY2tMaXN0ZW5lciA9IFBhcmFtZXRlckZlZWRiYWNrTGlzdGVuZXJJPFBhcmFtZXRlckNvbnRhaW5lcixQYXJhbWV0ZXJUeXBlPlxudHlwZSBQYXJhbWV0ZXJDb250YWluZXJIaWVyYXJjaHlMaXN0ZW5lciA9IFBhcmFtZXRlckNvbnRhaW5lckhpZXJhcmNoeUxpc3RlbmVySTxQYXJhbWV0ZXJDb250YWluZXIsUGFyYW1ldGVyVHlwZT5cblxuY2xhc3MgUGFyYW1ldGVyQ29udGFpbmVyIGV4dGVuZHMgR2VuZXJpY05vZGVQb2ludDxQYXJhbWV0ZXJDb250YWluZXI+e1xuXG4gIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZyl7XG4gICAgc3VwZXIobmFtZSk7XG4gIH1cbiAgXG4gIHB1YmxpYyBwYXJhbWV0ZXJDb250YWluZXJzOiB7W2lkOiBzdHJpbmddOiBQYXJhbWV0ZXJDb250YWluZXJ9ID0ge307XG4gIHB1YmxpYyBwYXJhbWV0ZXJzOiB7W2lkOiBzdHJpbmddOiBQYXJhbWV0ZXJUeXBlfSA9IHt9O1xuXG4gIHB1YmxpYyBmZWVkYmFja0xpc3RlbmVycyAgPSBuZXcgQXJyYXk8UGFyYW1ldGVyRmVlZGJhY2tMaXN0ZW5lcj4oKTtcbiAgcHVibGljIGhpZXJhcmNoeUxpc3RlbmVycyA9IG5ldyBBcnJheTxQYXJhbWV0ZXJDb250YWluZXJIaWVyYXJjaHlMaXN0ZW5lcj4oKTtcblxuICBwdWJsaWMgYWRkUGFyYW1ldGVyKHA6UGFyYW1ldGVyVHlwZSl7XG4gICAgdGhpcy5wYXJhbWV0ZXJzW3AubmFtZV0gPSBwO1xuICAgIHAuc2V0UGFyZW50Q29udGFpbmVyKHRoaXMpXG4gICAgcmV0dXJuIHBcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVQYXJhbWV0ZXIocDpQYXJhbWV0ZXJUeXBlKXtcbiAgICBwLnNldFBhcmVudENvbnRhaW5lcih1bmRlZmluZWQpXG4gICAgZGVsZXRlIHRoaXMucGFyYW1ldGVyc1twLm5hbWVdO1xuICAgIHRoaXMuZXZlbnRzLmVtaXQoJ3BhcmFtZXRlclJlbW92ZWQnLHRoaXMpO1xuICAgIHJldHVybiBwXG4gIH1cblxuICBwdWJsaWMgYWRkUGFyYW1ldGVyQ29udGFpbmVyKHA6UGFyYW1ldGVyQ29udGFpbmVyKXtcbiAgICB0aGlzLnBhcmFtZXRlckNvbnRhaW5lcnNbcC5uYW1lXSA9IHA7XG4gICAgcC5zZXRQYXJlbnRDb250YWluZXIodGhpcylcbiAgICB0aGlzLmV2ZW50cy5lbWl0KCdwYXJhbWV0ZXJDb250YWluZXJBZGRlZCcsdGhpcyk7XG4gICAgXG4gICAgcmV0dXJuIHBcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVQYXJhbWV0ZXJDb250YWluZXIocDpQYXJhbWV0ZXJDb250YWluZXIpe1xuICAgIHAuc2V0UGFyZW50Q29udGFpbmVyKHVuZGVmaW5lZClcbiAgICB0aGlzLnBhcmFtZXRlckNvbnRhaW5lcnNbcC5uYW1lXSA9IHA7XG4gICAgdGhpcy5ldmVudHMuZW1pdCgncGFyYW1ldGVyQ29udGFpbmVyUmVtb3ZlZCcsdGhpcyk7XG4gICAgcmV0dXJuIHBcbiAgfVxuXG4gIHB1YmxpYyBub3RpZnlDaGlsZENoYW5nZWQocDpQYXJhbWV0ZXJUeXBlKXtcbiAgICBsZXQgbm90aWZpZWQ6IFBhcmFtZXRlckNvbnRhaW5lciA9dGhpcztcbiAgICB3aGlsZShub3RpZmllZCl7XG4gICAgICBmb3IoY29uc3QgZiBvZiBub3RpZmllZC5mZWVkYmFja0xpc3RlbmVycyl7XG4gICAgICAgIGYucGFyYW1ldGVyQ2hhbmdlZCh0aGlzLHApO1xuICAgICAgfVxuICAgICAgbm90aWZpZWQgPSBub3RpZmllZC5wYXJlbnRDb250YWluZXJcbiAgICB9XG4gIH1cblxufVxuXG5jbGFzcyBQYXJhbWV0ZXIgZXh0ZW5kcyBHZW5lcmljUGFyYW1ldGVyPFBhcmFtZXRlckNvbnRhaW5lcj57XG4gICBcbn1cblxuXG4vLyB0eXBlIFBhcmFtZXRlckNvbnRhaW5lckhpZXJhcmNoeUxpc3RlbmVyID0gUGFyYW1ldGVyQ29udGFpbmVySGllcmFyY2h5TGlzdGVuZXJJPFBhcmFtZXRlckNvbnRhaW5lcixQYXJhbWV0ZXI+XG5cbi8vXG4vLyB7XG4vLyAgICBwYXJhbWV0ZXJBZGRlZCggcGM6IFBhcmFtZXRlckNvbnRhaW5lciwgcDogUGFyYW1ldGVyKSB7fTtcbi8vICAgIHBhcmFtZXRlclJlbW92ZWQoIHBjOiBQYXJhbWV0ZXJDb250YWluZXIsIHA6IFBhcmFtZXRlcikge307XG4vLyAgICBwYXJhbWV0ZXJDb250YWluZXJBZGRlZCggcGM6IFBhcmFtZXRlckNvbnRhaW5lciwgcDogUGFyYW1ldGVyKSB7fTtcbi8vICAgIHBhcmFtZXRlckNvbnRhaW5lclJlbW92ZWQoIHBjOiBQYXJhbWV0ZXJDb250YWluZXIsIHA6IFBhcmFtZXRlcikge307XG4vLyB9XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBERUNPUkFUT1JTXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5mdW5jdGlvbiBCaW5kUGFyYW1ldGVyKC4uLmFyZ3Mpe1xuICByZXR1cm4gZnVuY3Rpb24odGFyZ2V0OmFueSxrZXk6c3RyaW5nKXtcbiAgICBcbiAgICBpZighdGFyZ2V0W1wic3RhdGljUGFyYW1zXCJdKXtcbiAgICAgICAgdGFyZ2V0W1wic3RhdGljUGFyYW1zXCJdID0ge31cbiAgICB9XG4gICAgdGFyZ2V0W1wic3RhdGljUGFyYW1zXCJdW2tleV0gPSBhcmdzXG4gIH1cbn1cblxuXG5mdW5jdGlvbiBCaW5kUGFyYW1ldGVyQ29udGFpbmVyKC4uLmFyZ3Mpe1xuICByZXR1cm4gZnVuY3Rpb24odGFyZ2V0OmFueSxrZXk6c3RyaW5nKXtcbiAgICBpZighdGFyZ2V0W1wic3RhdGljUGFyYW1Db250c1wiXSl7XG4gICAgICAgIHRhcmdldFtcInN0YXRpY1BhcmFtQ29udHNcIl0gPSB7fVxuICAgIH1cbiAgICB0YXJnZXRbXCJzdGF0aWNQYXJhbUNvbnRzXCJdW2tleV0gPSBhcmdzXG4gIH1cbn1cblxuXG5mdW5jdGlvbiBCaW5kQ29udGFpbmVyPFQgZXh0ZW5kcyB7bmV3KC4uLmFyZ3M6YW55W10pOlBhcmFtZXRlckNvbnRhaW5lcn0+KCl7XG5cbiAgcmV0dXJuIGZ1bmN0aW9uIDxUIGV4dGVuZHMge25ldyguLi5hcmdzOmFueVtdKTpQYXJhbWV0ZXJDb250YWluZXJ9Pihjb25zdHJ1Y3RvcjpUKSB7XG4gICAgY29uc29sZS5sb2coJ2V2YWwgY29uc3QnKVxuICAgIHJldHVybiBjbGFzcyBleHRlbmRzIGNvbnN0cnVjdG9yIHtcbiAgICAgIGNvbnN0cnVjdG9yKC4uLmFyZ3Mpe1xuICAgICAgICBzdXBlciguLi5hcmdzKVxuICAgICAgICBjb25zb2xlLmxvZyhcInRyeSB0byBib3VuZCBzdGF0aWNcIilcbiAgICAgICAgY29uc3QgY2hlY2tOYW1lID0gKHBuOnN0cmluZyk9PntcbiAgICAgICAgICBpZighIChcIlwiK3RoaXNbcG5dLm5hbWUgaW4gW3BuLFwiXCJdKSApe1xuICAgICAgICAgICAgICAgIHRoaXNbcG5dLm5hbWUgPSBwblxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJyZW5hbWluZyBOb2RlIHRvIGl0cyBrZXkgbmFtZVwiKVxuICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYodGhpc1tcInN0YXRpY1BhcmFtc1wiXSl7XG4gICAgICAgICAgZm9yKGNvbnN0IHBuIG9mIE9iamVjdC5rZXlzKHRoaXNbXCJzdGF0aWNQYXJhbXNcIl0pKXtcbiAgICAgICAgICAgIGlmKCF0aGlzW3BuXSl7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY3JlYXRpbmcgcGFyYW0gXCIscG4pXG4gICAgICAgICAgICAgIHRoaXNbcG5dID0gbmV3IFBhcmFtZXRlcihwbilcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2V7Y2hlY2tOYW1lKHBuKX1cbiAgICAgICAgICAgIHRoaXMuYWRkUGFyYW1ldGVyKHRoaXNbcG5dKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHRoaXNbXCJzdGF0aWNQYXJhbUNvbnRzXCJdKXtcbiAgICAgICAgICBmb3IoY29uc3QgcG4gb2YgT2JqZWN0LmtleXModGhpc1tcInN0YXRpY1BhcmFtQ29udHNcIl0pKXtcbiAgICAgICAgICAgIGlmKCF0aGlzW3BuXSl7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY3JlYXRpbmcgcGFyYW0gXCIscG4pXG4gICAgICAgICAgICAgIHRoaXNbcG5dID0gbmV3IFBhcmFtZXRlckNvbnRhaW5lcihwbilcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2V7Y2hlY2tOYW1lKHBuKX1cbiAgICAgICAgICAgIHRoaXMuYWRkUGFyYW1ldGVyQ29udGFpbmVyKHRoaXNbcG5dKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuXG59XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFRFU1Rcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5AQmluZENvbnRhaW5lcigpXG5jbGFzcyBSb290Q29udCBleHRlbmRzIFBhcmFtZXRlckNvbnRhaW5lcntcbiAgY29uc3RydWN0b3IoKXtcbiAgICBzdXBlcigncENvbnQnKVxuICB9XG5cbiAgQEJpbmRQYXJhbWV0ZXIoKVxuICBwdWJsaWMgbnVtIDtcblxuICBAQmluZFBhcmFtZXRlckNvbnRhaW5lcigpXG4gIHB1YmxpYyBzdWJDb250ID0gbmV3IFBhcmFtZXRlckNvbnRhaW5lcihcImxralwiKTtcblxufVxuXG5cblxuY29uc29sZS5sb2coJ2luc3RhbmNpYXRlJylcbmNvbnN0IGNvbnQgPSBuZXcgUm9vdENvbnQoKVxuXG5cblxuZnVuY3Rpb24gUyhvKXtcbiAgY29uc3QgcmVzICA9IFtdXG4gIGZvcihjb25zdCBhIGluIG8pe1xuICAgIHJlcy5wdXNoKFthLG9bYV1dKVxuICB9XG4gIHJldHVybiByZXNcbiAgLy8gcmV0dXJuIE9iamVjdC5rZXlzKG8pO1xuICAvLyByZXR1cm4gSlNPTi5zdHJpbmdpZnkobyk7XG59XG5cbmNvbnNvbGUubG9nKFMoY29udCkpO1xuXG5cbmNvbnNvbGUubG9nKCdzZXR0aW5nJylcbmNvbnQubnVtLnNldCggNilcblxuXG5cbmNvbnNvbGUubG9nKGNvbnQubnVtLmNvbXB1dGVBZGRyZXNzKCkpIl19
